<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>GH\json.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Agent.html">Agent</a></li>
                                <li><a href="../classes/Animation.html">Animation</a></li>
                                <li><a href="../classes/Board.html">Board</a></li>
                                <li><a href="../classes/Campaign.html">Campaign</a></li>
                                <li><a href="../classes/Canvas2D.html">Canvas2D</a></li>
                                <li><a href="../classes/Cell.html">Cell</a></li>
                                <li><a href="../classes/Door.html">Door</a></li>
                                <li><a href="../classes/EntryTrigger.html">EntryTrigger</a></li>
                                <li><a href="../classes/gh.html">gh</a></li>
                                <li><a href="../classes/grahpics.html">grahpics</a></li>
                                <li><a href="../classes/graphics.html">graphics</a></li>
                                <li><a href="../classes/input.html">input</a></li>
                                <li><a href="../classes/json.html">json</a></li>
                                <li><a href="../classes/keyboard.html">keyboard</a></li>
                                <li><a href="../classes/Level.html">Level</a></li>
                                <li><a href="../classes/Map.html">Map</a></li>
                                <li><a href="../classes/math.html">math</a></li>
                                <li><a href="../classes/Mlayer.html">Mlayer</a></li>
                                <li><a href="../classes/Player.html">Player</a></li>
                                <li><a href="../classes/Sprite.html">Sprite</a></li>
                                <li><a href="../classes/stateSetup.html">stateSetup</a></li>
                                <li><a href="../classes/Wall.html">Wall</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/gh.html">gh</a></li>
                                <li><a href="../modules/graphics.html">graphics</a></li>
                                <li><a href="../modules/input.html">input</a></li>
                                <li><a href="../modules/StdLib.html">StdLib</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: GH\json.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&quot;use strict&quot;

/**
 * @module gh
 */


/**
 * @class gh
 */
var gh = (function(gh){

	console.log(&quot;json.js loaded&quot;);

	/**
	 * @class json
	 */
	var json = (function(json){

		/**
		 * Private globals
		 */
		var PATH = &quot;./Data/Campaigns/&quot;;

		/**
		 * @method loadCampaign
		 * @param {string} name The name of the current campaign
		 */
		json.loadCampaign = function(name){
			var path = PATH + name + &quot;/Data/&quot; + name + &quot;.json&quot;;
			var jsonData = json.getData(path);
			var jsonAgentTemplates = json.getData(PATH + name + &quot;/Data/creatures.json&quot;);
			var jsonWeaponTemplates = json.getData(PATH + name + &quot;/Data/weapons.json&quot;);

			var levels = [];
			for(var it = 0; it &lt; jsonData.levels.length; it++){
				if(jsonData.levels[it]){
					levels.push(json.loadLevel(name, jsonData.levels[it], jsonAgentTemplates));
				}
			}

			var campaign = new gh.Campaign(
				jsonData.name,
				jsonData.introText,
				levels
			);

			return campaign;
		};

		/**
		 * @method getData
		 * @param {string} path
		 * @return
		 */
		json.getData = function(path){
			var data = getAJAX(path);
			data = JSON.parse(data);

			return data;
		}

		/**
		 * @method loadLevel
		 * @param {string} campaignName
		 * @param {string} levelName
		 * @param {} jsonAgentTemplates
		 */
		json.loadLevel = function(campaignName, levelName, jsonAgentTemplates){
			var path = PATH + campaignName + &quot;/Data/&quot; + levelName + &quot;.json&quot;;
			var jsonData = getAJAX(path);
			jsonData = JSON.parse(jsonData);

			var level = new gh.Level(
				jsonData.name,
				jsonData.introText,
				jsonData.numHeroes,
				json.getAvailableHeroes(jsonData.availableHeroes), // availableHeroes
				json.getPlayers(jsonData.players, jsonAgentTemplates), // players
				undefined, // teams
				json.getMapData(jsonData.mapData)  // mapData
			);
			
			return level;
		};

		/**
		 * @method getHeroes
		 * @param {[string]} jsonData An array of available hero template IDs.
		 * @return
		 */
		json.getAvailableHeroes = function(jsonAvailableHeroes){
			var availableHeroes = [];

			for(var it = 0; it &lt; jsonAvailableHeroes.length; it++){
				availableHeroes.push(jsonAvailableHeroes[it]);
			}

			return availableHeroes;
		};

		/**
		 * @method getPlayers
		 * @param {[Player]} jsonPlayers
		 * @param {} jsonAgentTemplates
		 * @return
		 */
		json.getPlayers = function(jsonPlayers, jsonAgentTemplates){
			var players = [];
			var AI;

			if(jsonPlayers){
				for(var it = 0; it &lt; jsonPlayers.length; it++){
					if(jsonPlayers[it].AI === true){
						AI = gh.AI.COMPUTER;
					} else {
						AI = gh.AI.HUMAN;
					}
					players.push(
						new gh.Player(
							jsonPlayers[it].name,
							AI,
							json.getRoster(jsonPlayers[it].roster, jsonAgentTemplates)
						)
					);
				}
			}

			return players;
		};

		/**
		 * @method getRoster
		 * @param {[Agent]} jsonRoster
		 * @param {} jsonAgentTemplates
		 * @return
		 */
		json.getRoster = function(jsonRoster, jsonAgentTemplates){
			var roster = [];

			for(var it = 0; it &lt; jsonRoster.length; it++){
				var template = jsonAgentTemplates[jsonRoster[it].name];
				roster.push(
					new gh.Agent(
						jsonRoster[it].name,
						jsonRoster[it].id,
						jsonRoster[it].position.x,
						jsonRoster[it].position.y,
						jsonRoster[it].faction,
						template.description,
						template.body,
						template.mind,
						template.baseDefence,
						template.mainHand,
						template.offHand,
						template.chest,
						template.head,
						template.moveDice,
						template.baseMove,
						template.spellList,
						template.inventory
					)
				);
			}
			return roster;
		};

		/**
		 * @method getMapData
		 * @return
		 */
		json.getMapData = function(jsonMapData){
			var mapData 		= {};
			var board 			= [];
			var map 			= jsonMapData.map;
			var triggers 		= jsonMapData.triggers;
			var object 			= jsonMapData.objects;

			mapData.triggers	= json.getTriggers(triggers);

			// Get the raw cell data
			if(map !== undefined){
				for(var y = 0; y &lt; map.length; y++){
					board.push([]);
					board[y] = [];
					for(var x = 0; x &lt; map[y].length; x++){
						var cell = new gh.Cell(
							x, y,
							json.getBorder(map[y][x]),
							undefined, // agents
							undefined, // items
							json.findTriggers(x, y, mapData.triggers), // triggers
							map[y][x].visible, // visibility
							map[y][x].img  // spriteId
						);
						board[y].push(cell);
					}
				}
			}

			mapData.map = new gh.Map(board);

			// Add agent data
			// Add item data
			// Add trigger data

			return mapData;
		};

		/**
		 * @method getTriggers
		 * @param {JSON} jsonTriggers
		 */
		json.getTriggers = function(jsonTriggers){
			var triggers = [];

			for(var it = 0; it &lt; jsonTriggers.length; it++){
				switch(jsonTriggers[it].type){
					case &quot;entry&quot;:
						triggers.push(new gh.EntryTrigger(jsonTriggers[it].pos.x, jsonTriggers[it].pos.y));
						break;
					case &quot;exit&quot;:
						break;
					default:
						break;
				}
			}

			return triggers;
		}

		/**
		 * @method findTrigger
		 * @param {integer} x
		 * @param {integer} y
		 * @return
		 */
		json.findTriggers = function(x, y, triggers){
			var trig = [];

			for(var it = 0; it &lt; triggers.length; it++){
				if(triggers[it].x === x &amp;&amp; triggers[it].y === y){
					trig.push(triggers[it]);
				}
			}

			return trig;
		};

		/**
		 * @method getBorder
		 * @param
		 */
		json.getBorder = function(jsonCell){
			var cell = jsonCell;
			var border = {};
			if(cell.border){
				if(cell.border.wall){
					for(var it = 0; it &lt; cell.border.wall.length; it++){
						border[cell.border.wall[it]] = new gh.Wall(cell.border.wall[it], false, false);
					}
				} else if(cell.border.door){
					for(var key in cell.border.door){
						var door = cell.border.door[key];
						border[key] = new gh.Door(
							key, 
							door.open, 
							{
								&quot;open&quot; 					: &quot;openDoor.gif&quot;,
								&quot;closed&quot; 				: &quot;closedDoor.png&quot;,
								&quot;openDoorHighlight&quot; 	: &quot;openDoorHighlight.gif&quot;,
								&quot;closedHighlight&quot; 		: &quot;closedDoorHighlight.gif&quot;
							}
						);
					}
				}
			}

			return border;
		};

		/** 
		 * @method loadAssets
		 * @param {} assets
		 * @param {string} campaignName
		 * @param {string} levelName
		 * @return
		 */
		json.loadAssets = function(assets, campaignName, levelName){
			var path = PATH + campaignName + &quot;/Data/&quot; + levelName + &quot;.json&quot;;
			var data = json.getData(path);
			var map = data.mapData.map;

			json.getMapSpriteList(PATH + campaignName + &quot;/Graphics/&quot;, map, gh.assets.sprites);
			json.getBorderSprites(PATH + campaignName + &quot;/Graphics/Border/&quot;, data.stdGraphics, gh.assets.sprites);

			return true;
		};

		/**
		 * @method getMapSpriteList
		 * @param {} jsonMap
		 * @return
		 */
		json.getMapSpriteList = function(path, jsonMap, sprites){
			for(var y = 0; y &lt; jsonMap.length; y++){
				for(var x = 0; x &lt; jsonMap[y].length; x++){
					if(jsonMap[y][x].img){
						if(sprites[jsonMap[y][x].img] === undefined){
							sprites[jsonMap[y][x].img] = new graphics.Sprite(path + &quot;Floor Tiles/&quot; + jsonMap[y][x].img);
						}
					}
				}
			}

			return true;
		}

		/**
		 * @method getBorderSprites
		 * @param {string} path The folder in which the border sprites are located.
		 * @param {JSON} jsonBorderSprites The JSON data which includes the border sprite information.
		 * @param {gh.assets.sprites} sprites The asset sprite object which is to be updated with the new sprites.
		 * @return
		 */
		json.getBorderSprites = function(path, jsonBorderSprites, sprites){
			var doorSprites = jsonBorderSprites.door;
			for(var key in doorSprites){
				sprites[doorSprites[key]] = new graphics.Sprite(path + doorSprites[key]);
			}

			return true;
		};

		return json;
	})(json || {});

	gh.json = json;
	return gh;
})(gh || {});
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
