<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>GH\cell.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Agent.html">Agent</a></li>
                                <li><a href="../classes/Animation.html">Animation</a></li>
                                <li><a href="../classes/Board.html">Board</a></li>
                                <li><a href="../classes/Campaign.html">Campaign</a></li>
                                <li><a href="../classes/Canvas2D.html">Canvas2D</a></li>
                                <li><a href="../classes/Cell.html">Cell</a></li>
                                <li><a href="../classes/dom.html">dom</a></li>
                                <li><a href="../classes/Door.html">Door</a></li>
                                <li><a href="../classes/dss.html">dss</a></li>
                                <li><a href="../classes/EntryTrigger.html">EntryTrigger</a></li>
                                <li><a href="../classes/gh.html">gh</a></li>
                                <li><a href="../classes/grahpics.html">grahpics</a></li>
                                <li><a href="../classes/graphics.html">graphics</a></li>
                                <li><a href="../classes/HQDice.html">HQDice</a></li>
                                <li><a href="../classes/input.html">input</a></li>
                                <li><a href="../classes/Item.html">Item</a></li>
                                <li><a href="../classes/json.html">json</a></li>
                                <li><a href="../classes/keyboard.html">keyboard</a></li>
                                <li><a href="../classes/Level.html">Level</a></li>
                                <li><a href="../classes/Map.html">Map</a></li>
                                <li><a href="../classes/math.html">math</a></li>
                                <li><a href="../classes/Mlayer.html">Mlayer</a></li>
                                <li><a href="../classes/Player.html">Player</a></li>
                                <li><a href="../classes/Sprite.html">Sprite</a></li>
                                <li><a href="../classes/SpriteStrip.html">SpriteStrip</a></li>
                                <li><a href="../classes/stateGame.html">stateGame</a></li>
                                <li><a href="../classes/stateSetup.html">stateSetup</a></li>
                                <li><a href="../classes/stdlib.html">stdlib</a></li>
                                <li><a href="../classes/Vec2.html">Vec2</a></li>
                                <li><a href="../classes/Wall.html">Wall</a></li>
                                <li><a href="../classes/Weapon.html">Weapon</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/gh.html">gh</a></li>
                                <li><a href="../modules/graphics.html">graphics</a></li>
                                <li><a href="../modules/input.html">input</a></li>
                                <li><a href="../modules/stdlib.html">stdlib</a></li>
                                <li><a href="../modules/StdLib.html">StdLib</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: GH\cell.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&quot;use strict&quot;
/** 
 * @ module gh
 */


/**
 * @class gh
 */
var gh = (function(gh){
	console.log(&quot;cell.js loaded&quot;);
	/**
	 * Description
	 * border {
	 * 	top: {
	 * 			&quot;passable&quot; : true/false,
	 *			&quot;transparent&quot; : true/false,
	 *			&quot;door&quot; : true/false,
	 *			&quot;open&quot; : true/false,
	 * 			&quot;locked&quot; : true/false,
	 *			&quot;imageStates&quot; : {
	 *			}
	 *		 }
	 *	left: {}
	 * }
	 * @class Cell
	 * @constructor
	 * @param {integer} x The location of the cell on the x axis.
	 * @param {integer} y The location of the cell on the y axis.
	 * @param {} border
	 * @param {[Agent]} agents A list of agents occupying the cell.
	 * @param {[Item]} items A list of items on the cell.
	 * @param {[Trigger]} triggers A list of triggers on the cell.
	 * @param {graphics.Sprite} ptrSprite The name of the floor sprite which should be drawn.
	 * @param {float} rotation The degrees to which the image of the cell should be 
	 * rotated when drawn. For the purposes of use within a grid system this should be
	 * limited to a factor of 90 degrees.
	 * @return
	 */
	function Cell(x, y, border, agents, items, triggers, visible, spriteId, rotation){
		this.x 			= x || null;
		this.y 			= y || null;
		this.border 	= border || {};
		this.agents 	= agents || [];
		this.items 		= items || [];
		this.triggers	= triggers || [];
		this.visible 	= visible || {};
		this.spriteId	= spriteId || null;
		this.rotation	= rotation || 0;

		this.focus 		= false; // Is the mouse over the cell.

		return true;
	}

	/**
	 * @method drawFloor
	 * @param {Canvas.context} context
	 * @param {integer} tileSize
	 * @param {float} scale
	 * @param {} offset
	 * @param {string} team
	 * @return
	 */
	Cell.prototype.drawFloor = function(context, tileSize, scale, offset, team){

		if(this.visible &amp;&amp; this.visible[team] === true){
			context.save();
	
			if(this.spriteId){
				gh.assets.sprites[this.spriteId].draw(
					context, 
					this.x * tileSize * scale + offset.x,
					this.y * tileSize * scale + offset.y,
					tileSize * scale,
					tileSize * scale,
					this.rotation
				);
			}

			context.restore();
		}

		return true;
	};

	/**
	 * @method drawBorder
	 * @param {Canvas.context} context
	 * @param {float} tileSize
	 * @param {float} scale
	 * @param {} offset
	 * @param {string} team
	 */
	Cell.prototype.drawBorders = function(context, tileSize, scale, offset, team){
		if(this.border){

			if(this.visible &amp;&amp; this.visible[team] === true){
				context.save();

				for(var key in this.border){
					this.border[key].draw(context, tileSize, scale, offset);
				}

				context.restore();
			}
		}

		return true;
	};

	/**
	 * @method drawAgents
	 */
	Cell.prototype.drawAgents = function(context, tileSize, scale, offset, team){
		if(this.agents === undefined) return;
		if(this.agents.length &lt;= 0) return;

		if(this.visible &amp;&amp; this.visible[team] === true){
				context.save();

				// Only draw the last agent in the list
				this.agents[this.agents.length-1].draw(
					gh.assets.sprites, 
					context, 
					tileSize, 
					scale, 
					offset
				);

				context.restore();
		}
	};

	/**
	 * @method drawItems
	 * @param {} context
	 * @param {float} tileSize
	 * @param {float} scale
	 * @param {} offset
	 * @param {} team
	 */
	Cell.prototype.drawItems = function(context, tileSize, scale, offset, team){
		if(!this.items || (this.items.length === 0)){
			return;
		}

		if(this.visible &amp;&amp; this.visible[team] === true){
			context.save();

			this.items[this.items.length-1].draw(context, tileSize, scale, offset, team);

			context.restore();
		}

		return true;
	}

	/**
	 * @method setMouseFocus
	 * @param {integer} mouseX
	 * @param {integer} mouseY
	 * @param {float} tileSize
	 * @param {float} scale
	 * @param {} offset
	 * @param {} sprites
	 * @return
	 */
	Cell.prototype.setMouseFocus = function(mouseX, mouseY, tileSize, scale, offset, sprites){
		var focus = null;

		var relx = (mouseX - offset.x) - (this.x * tileSize * scale);
		var rely = (mouseY - offset.y) - (this.y * tileSize * scale);

		relx = relx / scale;
		rely = rely / scale;

		if(this.agents){
			var agent = this.agents[this.agents.length -1];
		}


		if(this.border){
			for(var key in this.border){
				if(this.border[key].isMouseOver(relx, rely, key, tileSize, sprites)){
					this.border[key].focus = true;
					return this.border[key];
				} else {
					this.border[key].focus = false;
				}
			} 
		}

		return focus;
	}

	/**
	 * @method removeAgent
	 * @param {gh.Agent} agent
	 */
	Cell.prototype.removeAgent = function(agent){
		for(var it = 0; it &lt; this.agents.length &amp;&amp; this.agents[it] !== agent; it++){

		}
		if(it &lt; this.agents.length){
			this.agents.splice(it, 1);
			console.log(this.agents);
		}
	};

	/**
	 * @method onClick
	 */
	Cell.prototype.onClick = function(mouseX, mouseY, tileSize, scale, offset, sprites, activeAgent){

		var obj = this.getClicked(mouseX, mouseY, tileSize, scale, offset, sprites);

		if(obj !== activeAgent){
			switch(activeAgent.actionState){
				case &quot;attack&quot;:
					if(obj instanceof gh.Agent){
						if(activeAgent.isHostile(obj, gh.ptrActiveLevel.teams)){
							var attack = activeAgent.attack(obj);

							if(attack !== null){
								gh.hud.displayAttack(activeAgent.mainHand.attackDice, attack.hits, obj.getDefenceDice(), attack.defence, obj);

								if(obj.damageHealth(attack.damage) === &quot;dead&quot;){
									this.removeAgent(obj);
								}
							}
						} else {
							console.log(&quot;invalid target&quot;);
						}
					}
					break;
				case &quot;search&quot;:
					break;
				case &quot;item&quot;:
					break;
				case &quot;traps&quot;:
					break;
				case &quot;spell&quot;:
					break;
				default:
					break;
			};
		}


		if(obj instanceof gh.Door){
			if(gh.getMapDist(activeAgent.x, activeAgent.y, this.x, this.y) &lt;= 1){
				if(obj.open === false){
					obj.open = true;
				} else {
					obj.open = false;
				}

				if(obj.open === true){
					//update the map visibility for the currently active agent
					gh.ptrActiveLevel.mapData.map.updateAgentVisibility(gh.ptrActiveLevel.manager.getActivePlayer().getActiveAgent());
				}
			}
		}

		if(obj instanceof gh.Wall){
			console.log(&quot;wall click&quot;);
		}
	}

	/**
	 * @method getClicked
	 * @param {integer} mouseX
	 * @param {integer} mouseY
	 * @param {float} tileSize
	 * @param {float} scale
	 * @param {} offset
	 * @param {} sprites
	 * @return
	 */
	Cell.prototype.getClicked = function(mouseX, mouseY, tileSize, scale, offset, sprites){
		// 1st get the relative position of the mouse coordinates with respect to the cell
		// Account for the image scale
		var relx = (mouseX - offset.x) - (this.x * tileSize * scale);
		var rely = (mouseY - offset.y) - (this.y * tileSize * scale);

		relx = relx / scale;
		rely = rely / scale;

		if(this.triggers &amp;&amp; this.triggers.length &gt; 0){
			for(var it = 0; it &lt; this.triggers.length; it++){
				if(this.triggers[it] instanceof gh.EntryTrigger &amp;&amp; this.triggers[it].active === true){
					return this.triggers[it];
				}				
			}
		}

		if(this.agents &amp;&amp; this.agents.length &gt; 0){
			var agent = this.agents[this.agents.length-1];
			if(agent.isClicked(relx, rely, tileSize, sprites)){
				return agent;
			}
		}

		if(this.border){
			for(var key in this.border){
				if(this.border[key].isClicked(relx, rely, key, tileSize, sprites)){
					return this.border[key];
				}
			}
		}

		return null;
	};

	gh.Cell = Cell;
	return gh;
})(gh || {});
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
